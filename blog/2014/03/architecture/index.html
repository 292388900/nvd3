
<!-- <!DOCTYPE html> -->
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Architecture - NVD3</title>
  <meta name="author" content="Novus Partners">

  
  <meta name="description" content="The first iteration of NVD3 dealt with complexity by copypasta code. This refactor aims to replace that copypasta with a sensible, object oriented &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://nvd3.org//blog/2014/03/architecture">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/data-table.css" media="screen, projection" rel="stylesheet" type="text/css" />
  <link href="/atom.xml" rel="alternate" title="NVD3" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

    <link href="/assets/css/bootstrap.css" rel="stylesheet">
    <style type="text/css">
      body {
        padding-top: 43px;
      }
      .statement_para {
          font-size: 14pt;
          line-height: 120%;
          width: 60%;
          text-align: justify;
          text-justify: distribute;
          margin: 10px auto;
          margin-bottom: 30px;
      }

      .row {
        margin 1%;
      }

      article {
        padding: 0 1%;
        font-size: 18px;
        line-height: 1.5em;
      }

      body > .container {
        width: 941px;
      }

      @media(min-width: 1200px){
        body > .container {
          width: 1171px;
        }
      }

      @media (max-width: 979px) and (min-width: 768px) {
        body > .container {
          width: 725px;
        }
      }

    </style>
    <link href="/assets/css/common.css" rel="stylesheet">
    <link href="/assets/css/nv.d3.css" rel="stylesheet">

    <script src="/assets/js/lib/bootstrap.min.js"></script>
<script src="/assets/lib/d3.v3.js"></script>
<script src="/assets/js/nv.d3.js"></script>

<script src="/assets/js/data/stream_layers.js"></script>
<script src="/assets/js/page/index.js"></script>


  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-33058059-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
    <nav role="navigation">    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="/index.html">NVD3.js</a>
          <div class="nav-collapse">
            <ul class="nav">
              <li class="active"><a href="/index.html"><i class="icon-white icon-home"></i> Home</a></li>
              <li><a href="/examples/index.html"><i class="icon-white icon-picture"></i> Examples</a></li>
              <li><a href="/livecode/index.html"><i class="icon-white icon-play-circle"></i> Live Code</a></li>
              <li><a href="http://github.com/novus/nvd3"><i class="icon-white icon-list-alt"></i> Source</a></li>
              <li><a href="/blog/archives/"><i class="icon-white icon-book"></i> Blog</a></li>
            </ul>
            <ul class="nav pull-right">
              <li><p class="navbar-text"><i class="icon-white icon-download"></i> Downloads:</p></li>
              <li>
                <div class="btn-group">
                  <a class="btn btn-small btn-primary" href="https://github.com/novus/nvd3/zipball/master">ZIP</a>
                  <a class="btn btn-small btn-primary" href="https://github.com/novus/nvd3/tarball/master">TAR.GZ</a>
                </div>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
</nav>

    <div class="container with-3d-shadow with-transitions">
        <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Architecture</h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-03-31T20:10:20-04:00" pubdate data-updated="true">Mar 31<span>st</span>, 2014</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>The first iteration of NVD3 dealt with complexity by copypasta code. This refactor aims to replace that copypasta with a sensible, object oriented design. Looking closely at the NVD3 codebase, there are some concepts that are easily abstractable. The first of these is the Layer &ndash; a thing to perform some DOM drawing on. The Layer manages the fundamental aspects of drawing a chart, especially the <a href="http://nvd3.org/blog/2014/03/nvd3-chart-drawing-lifecycle/">drawing lifecycle</a>. On top of a Layer are the several visualization pieces, like <a href="https://github.com/DavidSouther/nvd3/blob/canvas/src/models/pie/">Pie</a> and <a href="https://github.com/DavidSouther/nvd3/blob/canvas/src/models/line/">Line</a>, as well as the concept of a [Chart]. A chart is a composite object, managing the underlying visualization(s), the axes, the legend, and other common features.</p>

<h2>Extension Mechanism</h2>

<p>Because NVD3 targets modern web browsers, we use a variation of the <code>Object.create</code> pattern. An NVD3 constructor has a superclass, and a collection of private internal properties. This collection is stored in <code>Layer.options</code>, but allows getters and setters to be created automatically. Restricting external access to the <code>options</code> object allows significant flexibility in overriding specific chart functionalities.</p>

<p>To ease development, we&rsquo;ve introduced an <code>nv.utils.create(ctor, parent, privates)</code> (<a href="https://github.com/DavidSouther/nvd3/blob/canvas/src/utils.js#L327-L343">code</a>). This takes two constructor functions, links the prototype of the <code>ctor</code> to the <code>parent</code>, and creates a getter/setter method on the ctor prototype for each of the keys in <code>privates</code>. From this point, after instantiating the ctor class, all private internal data will be stored in its <code>options</code> key, while all access should come through the combined getter/setter methods. Client code can then override the default behavior by assigning a different function to ctor prorotype. Calling super methods should happen using <code>Function.prototype.apply()</code>.</p>

<p>Because the nv model functions return a callable function, we have also introduced <code>nv.utils.rebindp</code> (<a href="https://github.com/DavidSouther/nvd3/blob/canvas/src/utils.js#L301-L325">code</a>), which behaves similarly to <code>d3.rebind</code>, but calls functions on the source prototype, rather than the source itself.</p>

<h2>Object Composition</h2>

<p>Beyond extending and subclassing, Object Composition provides an excellent approach for achieving custom behaviors in similar charts. The Pie Chart labels have a <code>labelLayout</code> (<a href="https://github.com/DavidSouther/nvd3/blob/canvas/src/models/pie/pie.js#L1-L24">code</a>) property, which takes an object that knows the rules for laying out labels in a pie chart. Using Object Composition for specialized activities within the inheritance pattern will go a long ways towards creating extensible, maintainable, testable code.</p>

<p>Using these few primitives, we can build a very successful system. This new architecture should make NVD3 a solid library for charting requirements far into the future of front end development.</p>
</div>


  <footer>
    <p class="meta">
      
  


<span class="byline author vcard">Posted by <span class="fn"><a href="mailto:davidsouther@gmail.com">David Souther</a></span></span>

      








  


<time datetime="2014-03-31T20:10:20-04:00" pubdate data-updated="true">Mar 31<span>st</span>, 2014</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://nvd3.org//blog/2014/03/architecture/" data-via="" data-counturl="http://nvd3.org//blog/2014/03/architecture/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2014/03/nvd3-issues-triage/" title="Previous Post: nvd3 issues triage">&laquo; nvd3 issues triage</a>
      
      
        <a class="basic-alignment right" href="/blog/2014/03/nvd3-chart-drawing-lifecycle/" title="Next Post: NVD3 Chart Drawing Lifecycle">NVD3 Chart Drawing Lifecycle &raquo;</a>
      
    </p>
  </footer>
</article>

</div>


        <footer role="contentinfo"><p>
  Copyright &copy; 2014 - <a href="http://www.novus.com">Novus Partners</a> -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>

        





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>




    </div>
</body>
</html>
